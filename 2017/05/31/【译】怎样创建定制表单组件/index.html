
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>【译】怎样创建定制表单组件 | 荒村</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    
    <meta name="description" content="系列文章说明
原文


在许多情况下，可用的HTML表单组件是不够的。若你想在诸如&amp;lt;select&amp;gt;元素的组件上应用高级样式、或者想定制组件的行为，你就只能选择创建自己的表单组件。
我们将通过本文学习如何构建一个表单组件。为达到目的，我们选择重构&amp;lt;select&amp;gt;元素作为例子。
">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="荒村" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/Tinny.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/Tinny.jpg">
    

  
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    
  

    <link rel="stylesheet" href="/css/style.css">
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?d182ed77fc48758bf45a33835ee35745";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

      <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

  _st('install','Rr85pzY1M1tZC1UWGo8f');
</script>
</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="荒村">荒村</a></h1>
				<h2 class="blog-motto">新草掩旧路，野鬼吟残书。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
                    <ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于我</a></li>
					
					<li>
					
						<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="st-search-inpu" maxlength="20" placeholder="Search" />
						</form>
					
					</li>
                <!--<li><div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div></li>-->

				</ul>
			</nav>	
</div>
    </header>
    <div id="container" class="clearfix">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/05/31/【译】怎样创建定制表单组件/" title="【译】怎样创建定制表单组件" itemprop="url">【译】怎样创建定制表单组件</a>
  </h1>
  <p class="article-time">
    <time datetime="2017-05-31T10:45:53.000Z" itemprop="datePublished">2017年 5月 31日</time>
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title"></strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#设计，结构和语义"><span class="toc-number">1.</span> <span class="toc-text">设计，结构和语义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#定义HTML结构和语义"><span class="toc-number">1.1.</span> <span class="toc-text">定义HTML结构和语义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用CSS创建样式和交互"><span class="toc-number">1.2.</span> <span class="toc-text">用CSS创建样式和交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#必要的样式"><span class="toc-number">1.2.1.</span> <span class="toc-text">必要的样式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#美化"><span class="toc-number">1.2.2.</span> <span class="toc-text">美化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用JavaScript让组件“活”起来"><span class="toc-number">2.</span> <span class="toc-text">用JavaScript让组件“活”起来</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么不起作用？"><span class="toc-number">2.1.</span> <span class="toc-text">为什么不起作用？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#让工作轻松些"><span class="toc-number">2.2.</span> <span class="toc-text">让工作轻松些</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#建立事件回调"><span class="toc-number">2.3.</span> <span class="toc-text">建立事件回调</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#处理组件的值"><span class="toc-number">2.4.</span> <span class="toc-text">处理组件的值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#让组件变得无障碍"><span class="toc-number">3.</span> <span class="toc-text">让组件变得无障碍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#role特性"><span class="toc-number">3.1.</span> <span class="toc-text">role特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aria-selected特性"><span class="toc-number">3.2.</span> <span class="toc-text">aria-selected特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结论"><span class="toc-number">4.</span> <span class="toc-text">结论</span></a></li></ol>
		</div>
		
		<blockquote>
<ul>
<li><a href="http://levonlin.info/2016/04/28/%E3%80%90%E8%AF%91%E3%80%91HTML%E8%A1%A8%E5%8D%95%E6%8C%87%E5%8D%97-%E7%AC%AC%E4%B8%80%E4%B8%AAHTML%E8%A1%A8%E5%8D%95/">系列文章说明</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Forms/How_to_build_custom_form_widgets" target="_blank" rel="external">原文</a></li>
</ul>
</blockquote>
<p>在许多情况下，<a href="">可用的HTML表单组件</a>是不够的。若你想在诸如<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/select" target="_blank" rel="external"><code>&lt;select&gt;</code></a>元素的组件上<a href="">应用高级样式</a>、或者想定制组件的行为，你就只能选择创建自己的表单组件。</p>
<p>我们将通过本文学习如何构建一个表单组件。为达到目的，我们选择重构<code>&lt;select&gt;</code>元素作为例子。</p>
<blockquote>
<p><strong>注意：</strong>我们会专注于构建组件，但不会关注如何保证代码的通用和可重用。构建组件时会涉及到一些特殊的JavaScript代码和未知上下文中的DOM操作，而这些内容已经超出了本文的讨论范围。</p>
</blockquote>
<h2 id="设计，结构和语义"><a href="#设计，结构和语义" class="headerlink" title="设计，结构和语义"></a>设计，结构和语义</h2><p>在构建一个定制组件前，应先从明确你想要达到的效果开始，这会节省你宝贵的时间。具体来讲，清晰地定义组件的所有状态是很重要的。要做到这点，最好从一个已经存在的、状态和行为已经为人所熟知的组件开始，这样你就只需尽可能地模仿该组件即可。</p>
<p>在我们的例子中，我们会重构<code>&lt;select&gt;</code>元素。下面是我们期望达到的结果：</p>
<p><img src="https://developer.mozilla.org/files/4481/custom-select.png" alt=""></p>
<p>上面的截屏展示了我们组件的三个主要状态：普通状态（左）、激活状态（中）和打开状态（右）。</p>
<p>至于组件的行为，我们希望可以像其他原生组件一样，通过鼠标和键盘来操控它。先从定义组件如何到达各个状态开始：</p>
<p><strong>组件变为普通状态：</strong></p>
<ul>
<li>页面加载</li>
<li>组件激活且用户点击了组件外任意地方</li>
<li>组件激活且用户用键盘把焦点移动到别的组件</li>
</ul>
<blockquote>
<p><strong>注意：</strong>在页面上移动焦点通常是通过敲tab键来实现的，但不是所有地方都遵循这个惯例。比如Safari上默认是用<a href="http://www.456bereastreet.com/archive/200906/enabling_keyboard_navigation_in_mac_os_x_web_browsers/" target="_blank" rel="external">Option+Tab组合键</a>来实现在页面上移动焦点。</p>
</blockquote>
<p><strong>组件变为激活状态：</strong></p>
<ul>
<li>用户点击了组件</li>
<li>用户按tab键且组件获得了焦点</li>
<li>组件处于打开状态且用户点击了组件</li>
</ul>
<p><strong>组件变为打开状态：</strong></p>
<ul>
<li>组件处于其他非打开状态且用户点击了它</li>
</ul>
<p>在知道如何改变状态后，定义组件的值如何被改变也是很重要的：</p>
<p><strong>组件的值改变：</strong></p>
<ul>
<li>在组件处于打开状态时，用户点击了一个选项</li>
<li>在组件处于激活状态时，用户按了上下方向键</li>
</ul>
<p>最后我们来定义下组件选项的行为：</p>
<ul>
<li>当组件处于打开状态时，被选中的选项会高亮</li>
<li>当鼠标移到一个选项上，该选项会高亮且原先高亮状态的选项会恢复到普通状态</li>
</ul>
<p>考虑例子的演示目的，我们的分析就到此为止；然而如果你认真读过上文，会发现我们漏了一些效果。比如，当组件处于打开状态时，如果用户按了tab键会发生什么呢？答案是–什么都不会发生。正确的效果虽然显而易见（译注：参考select原生组件，也是什么都不会发生），但事实是我们没有在上述说明中定义它，这个效果很容易就会被忽视。在团队协作中，如果设计组件的人和实现它的人不同，这是特别容易出现的问题。</p>
<p>另一个有趣的问题是：组件处于打开状态时，用户按上下方向键会发生什么？要回答它，需要一点技巧。若考虑激活状态和打开状态是完全不相干的，那答案就还是“什么都不会发生”，因为我们并未给打开状态定义任何键盘交互。另一方面，如果考虑激活状态和打开状态有部分重叠，那答案就是：值可能会改变但选项也因此不会被高亮（译注：大概因为组件已经处于激活状态了吧），这也是因为当组件处于打开状态时，我们并未给选项未定义任何键盘交互（只是定义了组件打开时应该发生什么，却没定义打开后要干嘛）。</p>
<p>在我们的例子中，缺失的特性还是比较明显的，所以我们还能处理得了它；但当面对来自外部的新组件时，由于没人知道正确的行为是什么，这时就会造成真正的麻烦。因此，花些时间在设计阶段是很有必要的，如果你此时定义了一个不佳的交互，或忘记了去定义，后续在用户使用了该交互时再去重定义是很困难的。若（处理交互时）你有疑问，应积极寻求他人的帮助；而若你心中有数，则应毫不犹豫地<a href="http://en.wikipedia.org/wiki/Usability_testing" target="_blank" rel="external">进行用户测试</a>。上面讨论的过程，可称之为UX（译注：用户体验）设计。如果你想了解更多这方面的内容，可以参考下面这些资源：</p>
<ul>
<li><a href="http://www.uxmatters.com/" target="_blank" rel="external">UXMatters.com</a></li>
<li><a href="http://uxdesign.com/" target="_blank" rel="external">UXDesign.com</a></li>
<li><a href="http://uxdesign.smashingmagazine.com/" target="_blank" rel="external">The UX Design section of SmashingMagazine</a></li>
</ul>
<blockquote>
<p><strong>注意：</strong>在多数系统中，还有有一种方法可以打开<code>&lt;select&gt;</code>元素以查看所有可用的选项（这和用鼠标点击<code>&lt;select&gt;</code>元素是一样的）。这个方法在Windows下是用Alt+下方向键来实现的，我们的例子中并未实现它–但要这样做也很简单，因为整个操作的机制已经被用于实现click事件了。</p>
</blockquote>
<h3 id="定义HTML结构和语义"><a href="#定义HTML结构和语义" class="headerlink" title="定义HTML结构和语义"></a>定义HTML结构和语义</h3><p>上面我们确定了组建的基本功能，现在可以来构建我们的组件了。第一步我们要定义其HMLT结构，并为其添加基本的语义。下面是我们重构<code>&lt;select&gt;</code>元素所需的代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 这是组件的主要容器.</span></div><div class="line">     tabindex 特性用于让用户能聚焦到该组件。 </div><div class="line">     用JavaScript来设置它是一个更好的办法 --&gt;</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"select"</span> <span class="attr">tabindex</span>=<span class="string">"0"</span>&gt;</span></div><div class="line">  </div><div class="line">  <span class="comment">&lt;!-- 这个容器用于展示组件的当前值 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"value"</span>&gt;</span>Cherry<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">  </div><div class="line">  <span class="comment">&lt;!-- 这个容器会包含组件里的所有可用选项，因为选项是一个列表，所有采用ul元素更加合适 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"optList"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 每个选项只会包含要展示的内容，稍后我们会了解如何处理其真实值，用来和表单数据一起发出去 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Cherry<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Lemon<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Banana<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Strawberry<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Apple<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>要注意此处class名的使用；这些class标记了每个相关的元素，而不需要依赖其实际使用的HTML元素。这么做能确保我们不会把CSS和JavaScript与HTML结构作强关联，从而做到改变后续的组件代码实现时，不破坏使用该组件的代码。比如你想实现一个同样的<code>&lt;optgroup&gt;</code>元素时，可用直接用相同的代码来调用。</p>
<h3 id="用CSS创建样式和交互"><a href="#用CSS创建样式和交互" class="headerlink" title="用CSS创建样式和交互"></a>用CSS创建样式和交互</h3><p>现在我们已经有了组件的结构了，接下来要来设计组件了。创建这个自定义组件的目的，是为了用我们想要的形式来给该组件添加样式。要做到这点，我们要把CSS的编码工作拆为两部分：第一部分是让我们组件和<code>&lt;select&gt;</code>元素看起来一致的必要CSS规则，第二部分是用来让组件变成我们想要的样子的样式。</p>
<h4 id="必要的样式"><a href="#必要的样式" class="headerlink" title="必要的样式"></a>必要的样式</h4><p>必要的样式是用来处理我们组件的三个状态的。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.select</span> &#123;</div><div class="line">  <span class="comment">/* 给选项列表创建一个定位上下文 */</span></div><div class="line">  <span class="attribute">position</span>: relative;</div><div class="line"> </div><div class="line">  <span class="comment">/* 让我们的组件成为文本流的一部分，并使之可伸缩 */</span></div><div class="line">  <span class="attribute">display </span>: inline-block;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们需要一个额外类名<code>active</code>，来定义组件处于激活状态时的外观。因为我们的组件是可以获得操作焦点的，所以还要将相同的样式用于<code>:focus</code>伪类，保证激活和获得焦点时的行为一致。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.select</span><span class="selector-class">.active</span>,</div><div class="line"><span class="selector-class">.select</span><span class="selector-pseudo">:focus</span> &#123;</div><div class="line">  <span class="attribute">outline</span>: none;</div><div class="line"> </div><div class="line">  <span class="comment">/* box-shadow 属性不是必要的，但它可以作为默认值保证激活状态可见，去掉它也是可以的。 */</span></div><div class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">1px</span> <span class="number">#227755</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来处理选项列表：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 这里的 .select 选择器，用来确保后面选择器匹配的元素就是我们组件中那个 */</span></div><div class="line"><span class="selector-class">.select</span> <span class="selector-class">.optList</span> &#123;</div><div class="line">  <span class="comment">/* 下面样式确保选项列表会展示在当前值下面、并在HTML文档流之外 */</span></div><div class="line">  <span class="attribute">position </span>: absolute;</div><div class="line">  <span class="attribute">top      </span>: <span class="number">100%</span>;</div><div class="line">  <span class="attribute">left     </span>: <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们需要一个额外的class来处理选项列表的隐藏状态。为了管理激活和展开两个不同的状态，这么做是很有必要的。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.select</span> <span class="selector-class">.optList</span><span class="selector-class">.hidden</span> &#123;</div><div class="line">  <span class="comment">/* 下面是一个以无障碍方式来隐藏列表的简单方法，我们会在文末讨论更多关于无障碍访问的内容。 */</span></div><div class="line">  <span class="attribute">max-height</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">visibility</span>: hidden;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="美化"><a href="#美化" class="headerlink" title="美化"></a>美化</h4><p>在有了基本的功能之后，有趣的部分开始了。下面是一个可选的例子，效果和本文开头的那个截图一致。但是你也可以自由探索、看看你能实现怎样的效果。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.select</span> &#123;</div><div class="line">  <span class="comment">/* 所有的大小值都会采用em值来保证无障碍访问</span></div><div class="line">  （保证组件在用户使用浏览器纯文字模式下的缩放时，还保留自适应的能力）。</div><div class="line">  在计算时，假设1em == 16px，这也是大多数浏览器的默认值。</div><div class="line">  如果你对px到em的转换感到困惑，可以访问：http://riddle.pl/emcalc/ */</div><div class="line">  <span class="attribute">font-size   </span>: <span class="number">0.625em</span>; <span class="comment">/* this (10px) is the new font size context for em value in this context */</span></div><div class="line">  <span class="attribute">font-family </span>: Verdana, Arial, sans-serif;</div><div class="line"></div><div class="line">  <span class="attribute">-moz-box-sizing </span>: border-box;</div><div class="line">  <span class="attribute">box-sizing </span>: border-box;</div><div class="line"></div><div class="line">  <span class="comment">/* 需要额外的空间来添加向下箭头 */</span></div><div class="line">  <span class="attribute">padding </span>: .<span class="number">1em</span> <span class="number">2.5em</span> .<span class="number">2em</span> .<span class="number">5em</span>; <span class="comment">/* 1px 25px 2px 5px */</span></div><div class="line">  <span class="attribute">width   </span>: <span class="number">10em</span>; <span class="comment">/* 100px */</span></div><div class="line"></div><div class="line">  <span class="attribute">border        </span>: .<span class="number">2em</span> solid <span class="number">#000</span>; <span class="comment">/* 2px */</span></div><div class="line">  <span class="attribute">border-radius </span>: .<span class="number">4em</span>; <span class="comment">/* 4px */</span></div><div class="line">  <span class="attribute">box-shadow    </span>: <span class="number">0</span> .<span class="number">1em</span> .<span class="number">2em</span> <span class="built_in">rgba</span>(0,0,0,.45); <span class="comment">/* 0 1px 2px */</span></div><div class="line">  </div><div class="line">  <span class="comment">/* 第一句声明用于不支持线性渐变的浏览器。</span></div><div class="line">  第二句声明是因为基于Webkit的浏览器对线性渐变属性还要加个前缀。</div><div class="line">  若你还想支持老旧浏览器，可参考http://www.colorzilla.com/gradient-editor/ */</div><div class="line">  <span class="attribute">background </span>: <span class="number">#F0F0F0</span>;</div><div class="line">  <span class="attribute">background </span>: <span class="built_in">-webkit-linear-gradient</span>(90deg, #E3E3E3, #fcfcfc 50%, #f0f0f0);</div><div class="line">  <span class="attribute">background </span>: <span class="built_in">linear-gradient</span>(0deg, #E3E3E3, #fcfcfc 50%, #f0f0f0);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.select</span> <span class="selector-class">.value</span> &#123;</div><div class="line">  <span class="comment">/* 因为value元素可能会比组件还宽，所以我们得保障这不会改变组件的宽度 */</span></div><div class="line">  <span class="attribute">display  </span>: inline-block;</div><div class="line">  <span class="attribute">width    </span>: <span class="number">100%</span>;</div><div class="line">  <span class="attribute">overflow </span>: hidden;</div><div class="line"></div><div class="line">  <span class="attribute">vertical-align</span>: top;</div><div class="line"></div><div class="line">  <span class="comment">/* 如果内容溢出了，最好能有省略号来替代。 */</span></div><div class="line">  <span class="attribute">white-space  </span>: nowrap;</div><div class="line">  <span class="attribute">text-overflow</span>: ellipsis;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们不需要额外的元素来设计向下箭头，而是使用<code>:after</code>伪元素。但其实这也能在select类上用一个简单的背景图片来实现。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.select</span><span class="selector-pseudo">:after</span> &#123;</div><div class="line">  <span class="attribute">content </span>: <span class="string">"▼"</span>; <span class="comment">/* 使用 unicode 字符 U+25BC；参见 http://www.utf8-chartable.de */</span></div><div class="line">  <span class="attribute">position</span>: absolute;</div><div class="line">  <span class="attribute">z-index </span>: <span class="number">1</span>; <span class="comment">/* 用来保证箭头会叠在选项列表上面 */</span></div><div class="line">  <span class="attribute">top     </span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">right   </span>: <span class="number">0</span>;</div><div class="line"></div><div class="line">  <span class="attribute">-moz-box-sizing </span>: border-box;</div><div class="line">  <span class="attribute">box-sizing </span>: border-box;</div><div class="line"></div><div class="line">  <span class="attribute">height  </span>: <span class="number">100%</span>;</div><div class="line">  <span class="attribute">width   </span>: <span class="number">2em</span>;  <span class="comment">/* 20px */</span></div><div class="line">  <span class="attribute">padding-top </span>: .<span class="number">1em</span>; <span class="comment">/* 1px */</span></div><div class="line"></div><div class="line">  <span class="attribute">border-left  </span>: .<span class="number">2em</span> solid <span class="number">#000</span>; <span class="comment">/* 2px */</span></div><div class="line">  <span class="attribute">border-radius</span>: <span class="number">0</span> .<span class="number">1em</span> .<span class="number">1em</span> <span class="number">0</span>;  <span class="comment">/* 0 1px 1px 0 */</span></div><div class="line"></div><div class="line">  <span class="attribute">background-color </span>: <span class="number">#000</span>;</div><div class="line">  <span class="attribute">color </span>: <span class="number">#FFF</span>;</div><div class="line">  <span class="attribute">text-align </span>: center;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来，给选项列表添加样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.select</span> <span class="selector-class">.optList</span> &#123;</div><div class="line">  <span class="attribute">z-index </span>: <span class="number">2</span>; <span class="comment">/* 表明选项列表会始终叠在向下箭头之上 */</span></div><div class="line"></div><div class="line">  <span class="comment">/* 重置ul元素的默认样式 */</span></div><div class="line">  <span class="attribute">list-style</span>: none;</div><div class="line">  <span class="attribute">margin </span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line"></div><div class="line">  <span class="attribute">-moz-box-sizing </span>: border-box;</div><div class="line">  <span class="attribute">box-sizing </span>: border-box;</div><div class="line"></div><div class="line">  <span class="comment">/* 确保即使值太少让选项列表小于组件主体，也能让选项列表会和组件主体一样大 */</span></div><div class="line">  <span class="attribute">min-width </span>: <span class="number">100%</span>;</div><div class="line"></div><div class="line">  <span class="comment">/* 如果列表太长了，其内容会在垂直方向上溢出（默认会自动添加一个垂直方向的滚动条），</span></div><div class="line">    但不会在水平方向上也这样（因为我们没有设置宽度，列表会有个自适应宽度，如果不能自适应，</div><div class="line">    内容就会被截断） */</div><div class="line">  <span class="attribute">max-height</span>: <span class="number">10em</span>; <span class="comment">/* 100px */</span></div><div class="line">  <span class="attribute">overflow-y</span>: auto;</div><div class="line">  <span class="attribute">overflow-x</span>: hidden;</div><div class="line"></div><div class="line">  <span class="attribute">border</span>: .<span class="number">2em</span> solid <span class="number">#000</span>; <span class="comment">/* 2px */</span></div><div class="line">  <span class="attribute">border-top-width </span>: .<span class="number">1em</span>; <span class="comment">/* 1px */</span></div><div class="line">  <span class="attribute">border-radius</span>: <span class="number">0</span> <span class="number">0</span> .<span class="number">4em</span> .<span class="number">4em</span>; <span class="comment">/* 0 0 4px 4px */</span></div><div class="line"></div><div class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> .<span class="number">2em</span> .<span class="number">4em</span> <span class="built_in">rgba</span>(0,0,0,.4); <span class="comment">/* 0 2px 4px */</span></div><div class="line">  <span class="attribute">background</span>: <span class="number">#f0f0f0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于选项，我们需要添加一个highlight类来标明用户会选取（或已经选取）的值。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.select</span> <span class="selector-class">.option</span> &#123;</div><div class="line">  <span class="attribute">padding</span>: .<span class="number">2em</span> .<span class="number">3em</span>; <span class="comment">/* 2px 3px */</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.select</span> <span class="selector-class">.highlight</span> &#123;</div><div class="line">  <span class="attribute">background</span>: <span class="number">#000</span>;</div><div class="line">  <span class="attribute">color</span>: <span class="number">#FFFFFF</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面就是我们三个状态的实现效果了：<br><a href="https://developer.mozilla.org/en-US/docs/HTML/Forms/How_to_build_custom_form_widgets/Example_1" target="_blank" rel="external">效果</a></p>
<h2 id="用JavaScript让组件“活”起来"><a href="#用JavaScript让组件“活”起来" class="headerlink" title="用JavaScript让组件“活”起来"></a>用JavaScript让组件“活”起来</h2><p>现在我们组件的结构和设计都已经做好，可以来写JavaScript代码让组件真正能运行起来了。</p>
<blockquote>
<p><strong>警告：</strong>下面的代码是教学代码，在实际编码时不能直接像下面一样使用。其中许多部分，并没有未来使用的保障、而且也不能在老旧浏览器上使用。此外，这些代码也有在生产环境中应该被优化掉的冗余部分。</p>
<p><strong>注意：</strong>创建可复用的组件是很有技巧性的。<a href="http://dvcs.w3.org/hg/webcomponents/raw-file/tip/explainer/index.html" target="_blank" rel="external">W3C Web Component 草案</a>是这个特定问题的一个解决方案。<a href="http://x-tags.org/" target="_blank" rel="external">X-tag project</a>是这一规范的实验性实现；我们鼓励你好好了解下它。</p>
</blockquote>
<h3 id="为什么不起作用？"><a href="#为什么不起作用？" class="headerlink" title="为什么不起作用？"></a>为什么不起作用？</h3><p>在开始之前，我们需要知道JavaScript的一个严重问题：在浏览器里，它是一个不可靠的技术。当你在创建自定义组件的时候，你不得不依赖JavaScript，因为它是把所有东西维系在一起的绳索。但是，在许多情况下JavaScript并不能在浏览器中运行：</p>
<ul>
<li>用户禁用了JavaScript：这已经是个最不常见的情况了，现在很少有人会禁用JavaScript。</li>
<li>脚本没有加载：这是最普遍的情况，特别是在网络不太可靠的移动端。</li>
<li>脚本有bug：你要经常考虑这一可能性。</li>
<li>脚本和第三方脚本冲突了：使用了追踪脚本或用户自用的书签时会发生这种情况。</li>
<li>脚本和浏览器拓展（如火狐的<a href="https://addons.mozilla.org/fr/firefox/addon/noscript/" target="_blank" rel="external">NoScript</a>拓展或Chrome的<a href="https://chrome.google.com/webstore/detail/notscripts/odjhifogjcknibkahlpidmdajjpkkcfn" target="_blank" rel="external">NoScripts</a>拓展）发生冲突、或受到干扰。</li>
<li>用户使用了老旧浏览器，并且你需要的一种特性不被支持：这通常发生在你用了很新的API时。</li>
</ul>
<p>由于有这些风险，我们需要认真考虑下JavaScript不起作用时会发生什么。深入处理这个问题已经超出了本文的论述范围，因为这和你希望如何让脚本通用和可复用密切相关，我们不会在例子中考虑这点。</p>
<p>在本文的例子中，若JavaScript代码不能运行，我们会回退到展示标准的<code>&lt;select&gt;</code>元素。要做到这点，得先来做两件事。</p>
<p>首先，我们要在使用自定义组件之前，添加一个普通的<code>&lt;select&gt;</code>元素。而为了能让自定义组件的数据和剩下的表单数据一起发送，这一步也是很有必要的。后边我们还会详细介绍。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"no-widget"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"myFruit"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">option</span>&gt;</span>Cherry<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">option</span>&gt;</span>Lemon<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">option</span>&gt;</span>Banana<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">option</span>&gt;</span>Strawberry<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">option</span>&gt;</span>Apple<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"select"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"value"</span>&gt;</span>Cherry<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"optList hidden"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Cherry<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Lemon<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Banana<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Strawberry<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Apple<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>第二，我们还得添加两个新的类名，实现隐藏不需要的元素（即在脚本能运行时的<code>&lt;select&gt;</code>元素、或脚本不能运行时的自定义组件）。要注意的是在默认情况下，此处的HTML代码会隐藏自定义组件。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.widget</span> <span class="selector-tag">select</span>,</div><div class="line"><span class="selector-class">.no-widget</span> <span class="selector-class">.select</span> &#123;</div><div class="line">  <span class="comment">/* 这个CSS选择器意思是：</span></div><div class="line">     - 要么body的类名被设为"widget"，此处就要隐藏`&lt;select&gt;`元素</div><div class="line">     - 要么body的类名没有改变，仍是"no-widget"，那么类名为"select"的元素就要被隐藏了 */</div><div class="line">  <span class="attribute">position </span>: absolute;</div><div class="line">  <span class="attribute">left     </span>: -<span class="number">5000em</span>;</div><div class="line">  <span class="attribute">height   </span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">overflow </span>: hidden;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>至此，我们只需要一个JavaScript开关来决定脚本是否能运行了。这个开关很简单：若页面加载了脚本并运行，就会移除<code>no-widget</code>类并添加<code>widget</code>类，实现对<code>&lt;select&gt;</code>元素和自定义组件可见与否的切换。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">document</span>.body.classList.remove(<span class="string">"no-widget"</span>);</div><div class="line">  <span class="built_in">document</span>.body.classList.add(<span class="string">"widget"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><a href="https://developer.mozilla.org/en-US/docs/HTML/Forms/How_to_build_custom_form_widgets/Example_2" target="_blank" rel="external">效果</a></p>
<blockquote>
<p><strong>注意：</strong>若你真的想让你的组件变得通用和可复用，除了作类名的切换，更好的方法是（在脚本能执行时）只添加<code>widget</code>类名隐藏<code>&lt;select&gt;</code>元素，并在页面中的每个<code>&lt;select&gt;</code>元素后面指定自定义的组件、动态添加到DOM树中。</p>
</blockquote>
<h3 id="让工作轻松些"><a href="#让工作轻松些" class="headerlink" title="让工作轻松些"></a>让工作轻松些</h3><p>在将要创建的代码中，我们会使用标准的DOM API来完成工作。然而，尽管浏览器对DOM API的支持已经越来越好，但在老旧浏览器上仍存在一些问题（特别在很老的IE上）。</p>
<p>若你想避免老旧浏览器上的麻烦，有两种方法可以做到：使用诸如<a href="http://jquery.com/" target="_blank" rel="external">jQuery</a>, <a href="https://github.com/julienw/dollardom" target="_blank" rel="external">$dom</a>, <a href="http://prototypejs.org/" target="_blank" rel="external">prototype</a>, <a href="http://dojotoolkit.org/" target="_blank" rel="external">Dojo</a>, <a href="http://yuilibrary.com/" target="_blank" rel="external">YUI</a>之类的稳定框架；或者补充那些缺失的但你要用的特性（通过条件加载可以很容易做到这点，比如可以使用<a href="http://yepnopejs.com/" target="_blank" rel="external">yepnope</a>库）。</p>
<p>我们计划使用的特性如下（从风险最大到最安全排列）：</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/classList" target="_blank" rel="external">classList</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" target="_blank" rel="external">addEventListener</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/forEach" target="_blank" rel="external">forEach</a>（不属于DOM但是现代JavaScript的特性）</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/querySelector" target="_blank" rel="external">querySelector</a>和<a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/querySelectorAll" target="_blank" rel="external">querySelectorAll</a></li>
</ol>
<p>除了上述特性的可用性，在开发之前仍存在一个问题。<code>querySelector()</code>方法返回的是一个<code>NodeList</code>而不是数组。<code>Array</code>对象支持<code>forEach</code>方法、但<code>NodeList</code>不支持。因为<code>NodeList</code>看起来像数组、也因为<code>forEach</code>方法用起来很方便，所以我们可以很简单地就给<code>NodeList</code>添加<code>forEach</code>支持、让我们的工作轻松些，就像下面这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NodeList.prototype.forEach = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</div><div class="line">  <span class="built_in">Array</span>.prototype.forEach.call(<span class="keyword">this</span>, callback);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们说这很简单可不是瞎说的哦。</p>
<h3 id="建立事件回调"><a href="#建立事件回调" class="headerlink" title="建立事件回调"></a>建立事件回调</h3><p>前期工作已经做好了，我们现在可以来定义用户和我们的组件交互时要用到的所有函数了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 这个函数会在取消激活自定义组件时被使用</span></div><div class="line">    需要一个参数：</div><div class="line">    select： 类名为`select`且要被取消激活的DOM节点</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">deactivateSelect</span>(<span class="params">select</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">/* 若组件未被激活，则什么都不做 */</span></div><div class="line">  <span class="keyword">if</span> (!select.classList.contains(<span class="string">'active'</span>)) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">  <span class="comment">/* 获取自定义组件的选项列表 */</span></div><div class="line">  <span class="keyword">var</span> optList = select.querySelector(<span class="string">'.optList'</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* 关闭选项列表 */</span></div><div class="line">  optList.classList.add(<span class="string">'hidden'</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* 取消自定义组件的激活状态 */</span></div><div class="line">  select.classList.remove(<span class="string">'active'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* 该函数用于让用户（取消）激活组件</span></div><div class="line">    需要两个参数：</div><div class="line">    select：类名为`select`且要被激活的DOM节点</div><div class="line">    selectList：类名为`select`的所有DOM节点的列表</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">activeSelect</span>(<span class="params">select, selectList</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">/* 若组件已经激活，则什么都不做 */</span></div><div class="line">  <span class="keyword">if</span> (select.classList.contains(<span class="string">'active'</span>)) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">  <span class="comment">/* 所有自定义组件的激活状态都得取消，</span></div><div class="line">    因为deactivateSelect函数满足了作为forEach回调函数的要求，</div><div class="line">    所以我们会直接使用它而不是用一个中间的匿名函数</div><div class="line"> */</div><div class="line">  selectList.forEach(deactivateSelect);</div><div class="line"></div><div class="line">  <span class="comment">/* 开启该组件的激活状态 */</span></div><div class="line">  select.classList.add(<span class="string">'active'</span>);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="comment">/* 该函数用于让用户打开和关闭选项列表</span></div><div class="line">    需要一个参数：</div><div class="line">    select：有一个列表要切换状态的DOM节点</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleOptList</span>(<span class="params">select</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">/* 选项列表可以从组件那获得 */</span></div><div class="line">  <span class="keyword">var</span> optList = select.querySelector(<span class="string">'.optList'</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* 改变列表的类名来展示和隐藏它 */</span></div><div class="line">  optList.classList.toggle(<span class="string">'hidden'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* 该函数用于高亮一个选项</span></div><div class="line">    需要两个参数：</div><div class="line">    select：类名为`select`且包含要被高亮选项的DOM节点</div><div class="line">    option：类名为`option`且要被高亮的DOM节点</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">highlightOption</span>(<span class="params">select, option</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">/* 获得自定义select元素的所有可用选项 */</span></div><div class="line">  <span class="keyword">var</span> optionList = select.querySelectorAll(<span class="string">'.option'</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* 移除所有选项的高亮 */</span></div><div class="line">  optionList.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">other</span>) </span>&#123;</div><div class="line">    other.classList.remove(<span class="string">'highlight'</span>);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">/* 高亮正确的选项 */</span></div><div class="line">  option.classList.add(<span class="string">'highlight'</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>上面就是处理自定义组件的多个状态所需的所有函数。</p>
<p>接下来，我们把这些函数绑到合适的事件上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 在文档加载出来后处理下事件绑定 */</span></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> selectList = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.select'</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* 每个自定义组件都要被初始化 */</span></div><div class="line">  selectList.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">select</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/* 所有的`select`元素也要被初始化 */</span></div><div class="line">    <span class="keyword">var</span> optionList = select.querySelectorAll(<span class="string">'.option'</span>);</div><div class="line"></div><div class="line">    <span class="comment">/* 用户把鼠标放到一个选项上时，高亮该选项 */</span></div><div class="line">    optionList.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">option</span>) </span>&#123;</div><div class="line">      option.addEventListener(<span class="string">'mouseover'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">/* 注意：在我们的函数调用内，`select`和`option`变量都是局部的 */</span></div><div class="line">        highlightOption(select, option);</div><div class="line">      &#125;);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">/* 用户点击了自定义的select元素 */</span></div><div class="line">    select.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">      <span class="comment">/* 注意：在我们的函数调用内，`select`变量是局部的 */</span></div><div class="line">      <span class="comment">/* 改变选项列表的可见状态 */</span></div><div class="line">      toggleOptList(select);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">/* 组件获得焦点时</span></div><div class="line">    /* 用户点击组件或用tab键访问组件时，组件会获得焦点 */</div><div class="line">    select.addEventListener(<span class="string">'focus'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">       <span class="comment">/* 注意：在我们的函数调用内，`select`和`selectList`变量都是局部的 */</span></div><div class="line"></div><div class="line">      <span class="comment">/* 激活该组件 */</span></div><div class="line">      activeSelect(select, selectList);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">/* 组件失去焦点时 */</span></div><div class="line">    select.addEventListener(<span class="string">'blur'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">       <span class="comment">/* 注意：在我们的函数调用内，`select`变量是局部的 */</span></div><div class="line"></div><div class="line">      <span class="comment">/* 取消激活该组件 */</span></div><div class="line">      deactivateSelect(select);</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>至此，组件已经能根据我们的设计来改变其状态了，但它的值目前还不会更新，接下来我们就会处理这点。</p>
<p><a href="https://developer.mozilla.org/en-US/docs/HTML/Forms/How_to_build_custom_form_widgets/Example_3" target="_blank" rel="external">效果</a></p>
<h3 id="处理组件的值"><a href="#处理组件的值" class="headerlink" title="处理组件的值"></a>处理组件的值</h3><p>现在组件已经能用了，但我们还得加点代码，根据用户的输入更新它的值、并让其能随着表单数据一起发送它的值。</p>
<p>要做到这点，最简单的方式就是在私底下用一个原生组件。这样一来，自定义组件就会跟踪浏览器提供的内置控件的值，并和平时一样在表单提交时发送它的值。在浏览器已经为我们做好这一切时，没有必要来重新发明轮子了。</p>
<p>如前所示，出于可访问性的原因，我们已经用了一个原生的select组件来作为回退；同步这个组件的值和自定义组件的值是很容易的：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 该函数用于更新展示的值，并和原生组件作同步</span></div><div class="line"><span class="comment">// 需要两个参数：</span></div><div class="line"><span class="comment">// select：类名为`select`且值要更新的DOM节点</span></div><div class="line"><span class="comment">// index：选定的值的索引</span></div><div class="line"><span class="function">function <span class="title">updateValue</span>(<span class="params"><span class="keyword">select</span>, index</span>) </span>&#123;</div><div class="line">  <span class="comment">// 我们得为给定的自定义组件获取原生组件</span></div><div class="line">  <span class="comment">// 本例中，原生组件是自定义组件的兄弟节点</span></div><div class="line">  <span class="keyword">var</span> nativeWidget = <span class="keyword">select</span>.previousElementSibling;</div><div class="line"></div><div class="line">  <span class="comment">// 获得自定义组件的值容器</span></div><div class="line">  <span class="keyword">var</span> <span class="keyword">value</span> = <span class="keyword">select</span>.querySelector(<span class="string">'.value'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 获得完整的选项列表</span></div><div class="line">  <span class="keyword">var</span> optionList = <span class="keyword">select</span>.querySelectorAll(<span class="string">'.option'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 设置选中索引为我们选择的选项的索引</span></div><div class="line">  nativeWidget.selectedIndex = index;</div><div class="line"></div><div class="line">  <span class="comment">// 更新对应的值容器</span></div><div class="line">  <span class="keyword">value</span>.innerHTML = optionList[index].innerHTML;</div><div class="line"></div><div class="line">  <span class="comment">// 高亮自定义组件中关联的选项</span></div><div class="line">  highlightOption(<span class="keyword">select</span>, optionList[index]);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 该函数返回原生组件当前选中的索引</span></div><div class="line"><span class="comment">// 需要一个参数：</span></div><div class="line"><span class="comment">// select：类名为`select`且和原生组件关联的DOM节点</span></div><div class="line"><span class="function">function <span class="title">getIndex</span>(<span class="params"><span class="keyword">select</span></span>) </span>&#123;</div><div class="line">  <span class="comment">// 我们得为给定的自定义组件获取原生组件</span></div><div class="line">  <span class="comment">// 本例中，原生组件是自定义组件的兄弟节点</span></div><div class="line">  <span class="keyword">var</span> nativeWidget = <span class="keyword">select</span>.previousElementSibling;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> nativeWidget.selectedIndex;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>我们可以用上面这两个函数来绑定原生组件和自定义组件：</p>
<figure class="highlight scilab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 在文档加载出来后处理下事件绑定</span></div><div class="line">window.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></div><div class="line">  var selectList = document.querySelectorAll(<span class="string">'.select'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 每个自定义组件都要被初始化</span></div><div class="line">  selectList.forEach(<span class="function"><span class="keyword">function</span> <span class="params">(select)</span> &#123;</span></div><div class="line">    var optionList = select.querySelectorAll(<span class="string">'.option'</span>),</div><div class="line">        selectedIndex = getIndex(<span class="keyword">select</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 让自定义组件能聚焦</span></div><div class="line">    select.tabIndex = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 让原生组件不可聚焦</span></div><div class="line">    select.previousElementSibling.tabIndex = <span class="number">-1</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 确保默认选择的值被正确展示</span></div><div class="line">    updateValue(<span class="keyword">select</span>, selectedIndex);</div><div class="line"></div><div class="line">    <span class="comment">// 用户点击选项时，更新对应的值</span></div><div class="line">    optionList.forEach(<span class="function"><span class="keyword">function</span> <span class="params">(option, index)</span> &#123;</span></div><div class="line">      option.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> &#123;</span></div><div class="line">        updateValue(<span class="keyword">select</span>, index);</div><div class="line">      &#125;);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// 用户在聚焦的组件上按键盘时，更新对应的值</span></div><div class="line">    select.addEventListener(<span class="string">'keyup'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> &#123;</span></div><div class="line">      var <span class="built_in">length</span> = optionList.<span class="built_in">length</span>,</div><div class="line">          index  = getIndex(<span class="keyword">select</span>);</div><div class="line"></div><div class="line">      <span class="comment">// 当用户按下箭头时，跳到后一选项</span></div><div class="line">      <span class="keyword">if</span> (event.keyCode === <span class="number">40</span> &amp;&amp; index &lt; <span class="built_in">length</span> - <span class="number">1</span>) &#123; index++; &#125;</div><div class="line"></div><div class="line">      <span class="comment">// 当用户按上箭头时，跳到前一选项</span></div><div class="line">      <span class="keyword">if</span> (event.keyCode === <span class="number">38</span> &amp;&amp; index &gt; <span class="number">0</span>) &#123; index--; &#125;</div><div class="line"></div><div class="line">      updateValue(<span class="keyword">select</span>, index);</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面的代码里，要注意<a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/tabIndex" target="_blank" rel="external">tabIndex</a>属性的使用。该属性用来确保原生组件不会获得焦点，并确保自定义组件能在用户用键盘或鼠标访问时获得焦点。</p>
<p>通过上面的工作，我们已经完成任务了！下面就是结果：</p>
<p><a href="https://developer.mozilla.org/en-US/docs/HTML/Forms/How_to_build_custom_form_widgets/Example_4" target="_blank" rel="external">效果</a></p>
<p>等等，我们真的完成了吗？</p>
<h2 id="让组件变得无障碍"><a href="#让组件变得无障碍" class="headerlink" title="让组件变得无障碍"></a>让组件变得无障碍</h2><p>我们已经构建了一个可以运行的组件，虽然距离得到一个具有完整特性的选择框还很远，但它运行得还不错。然而，我们之前所做的只是在处理DOM而已，这个组件并不是真正语义化的，而且虽然它看起来像个选择框，但在浏览器的角度它却并不是这样，因此无障碍技术也不会认为它是个选择框。简而言之，它就是个无障碍性很差的漂亮选择框！</p>
<p>幸运的是，我们有个解决方案叫<a href="https://developer.mozilla.org/en-US/docs/Accessibility/ARIA" target="_blank" rel="external">ARIA</a>。ARIA表示“无障碍的富Internet应用”，它是个<a href="http://www.w3.org/TR/wai-aria/" target="_blank" rel="external">W3C规范</a>，用来让web应用和自定义组件变得无障碍。基本上这个规范就是一系列拓展了HTML的特性，用这些特性，我们可以更好地描述角色、状态和属性，让我们刚才设计的元素变得像其尽力模仿的原生元素一样。使用这些特性很简单，下面我们来试试。</p>
<h3 id="role特性"><a href="#role特性" class="headerlink" title="role特性"></a>role特性</h3><p>ARIA使用的关键特性是<a href="https://developer.mozilla.org/en-US/docs/Accessibility/ARIA/ARIA_Techniques" target="_blank" rel="external">role</a>。该特性会接收一个定义了元素用途的值，每个值都代表了元素的特点和行为。在本例中，我们会使用一个<a href="https://developer.mozilla.org/en-US/docs/Accessibility/ARIA/ARIA_Techniques/Using_the_listbox_role" target="_blank" rel="external">listbox</a>作为role值，这个值是个“复合的role”，指定的元素可以包含多个特定role的子元素（本例中，至少有一个元素role值为<code>option</code>）。</p>
<p>值得注意的是，ARIA定义的role默认会自动用于标准的HTML标签中。比如说，<code>&lt;table&gt;</code>元素对应<code>grid</code>，<code>&lt;ul&gt;</code>元素对应<code>list</code>。因为我们的组件使用了<code>&lt;ul&gt;</code>元素，所以得确保组件的<code>listbox</code> role能覆盖掉<code>&lt;ul&gt;</code>元素的<code>list</code>值。为此，可以使用<code>presentation</code>这个role值，该值用来指明一个没有特殊含义的元素，而且该元素只用来展示信息而已。这里我们会给<code>&lt;ul&gt;</code>应用<code>presentation</code>值。</p>
<p>要使用<code>listbox</code>这个role值，得像下面一样修改HTML：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 给最外层元素指定role="listbox" --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"select"</span> <span class="attr">role</span>=<span class="string">"listbox"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"value"</span>&gt;</span>Cherry<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- 给ul元素指定role="presentation" --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"optList"</span> <span class="attr">role</span>=<span class="string">"presentation"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 给所有li元素指定role="presentation" --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"option"</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Cherry<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"option"</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Lemon<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"option"</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Banana<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"option"</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Strawberry<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"option"</span> <span class="attr">class</span>=<span class="string">"option"</span>&gt;</span>Apple<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>如果你想兼容那些不支持<a href="https://developer.mozilla.org/en-US/docs/CSS/Attribute_selectors" target="_blank" rel="external">CSS特性选择器</a>的老旧浏览器，同时使用<code>role</code>特性和<code>class</code>特性这种做法是必须的。</p>
</blockquote>
<h3 id="aria-selected特性"><a href="#aria-selected特性" class="headerlink" title="aria-selected特性"></a>aria-selected特性</h3><p>仅使用role特性是不够的，ARIA本身也提供了很多许多状态和属性特性。对这些特性用得越多和越恰当，网页就越能被无障碍技术所理解。在我们的例子中，只会用到一个特性：<code>aria-selected</code>。</p>
<p><code>aria-selected</code>特性用于标记当前选中的选项，这样无障碍技术就能提示用户当前选中项是什么。我们会在JavaScript中动态地使用它，在用户选中一个选项时能标记该选中项。为此，得修改下<code>updateValue()</code>函数：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function">function <span class="title">updateValue</span>(<span class="params"><span class="keyword">select</span>, index</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> nativeWidget = <span class="keyword">select</span>.previousElementSibling;</div><div class="line">  <span class="keyword">var</span> <span class="keyword">value</span> = <span class="keyword">select</span>.querySelector(<span class="string">'.value'</span>);</div><div class="line">  <span class="keyword">var</span> optionList = <span class="keyword">select</span>.querySelectorAll(<span class="string">'.option'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 确保所有的选项未被选中</span></div><div class="line">  optionList.forEach(function (other) &#123;</div><div class="line">    other.setAttribute(<span class="string">'aria-selected'</span>, <span class="string">'false'</span>);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// 确保选择的那个选项被选中</span></div><div class="line">  optionList[index].setAttribute(<span class="string">'aria-selected'</span>, <span class="string">'true'</span>);</div><div class="line"></div><div class="line">  nativeWidget.selectedIndex = index;</div><div class="line">  <span class="keyword">value</span>.innerHTML = optionList[index].innerHTML;</div><div class="line">  highlightOption(<span class="keyword">select</span>, optionList[index]);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>上述修改的最终效果如下（访问该组件时使用无障碍技术，譬如<a href="http://www.nvda-project.org/" target="_blank" rel="external">NVDA</a>或<a href="http://www.apple.com/accessibility/voiceover/" target="_blank" rel="external">VoiceOver</a>，会有更好的体验）：</p>
<p><a href="https://developer.mozilla.org/en-US/docs/HTML/Forms/How_to_build_custom_form_widgets/Example_5" target="_blank" rel="external">效果</a></p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>至此我们已经了解了创建定制表单组件的所有基本知识，但如你所见，这么做并不简单，如果使用第三方库的话会比自己从头写起更好、更简单（当然除非你是想构建这样一个库）。</p>
<p>下面是你在自己开发之前应该参考下的库：</p>
<ul>
<li><a href="http://jqueryui.com/" target="_blank" rel="external">jQuery UI</a></li>
<li><a href="https://github.com/marghoobsuleman/ms-Dropdown" target="_blank" rel="external">msDropDown</a></li>
<li><a href="http://www.emblematiq.com/lab/niceforms/" target="_blank" rel="external">Nice Forms</a></li>
<li><a href="https://www.google.fr/search?q=HTML+custom+form+controls&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=org.mozilla:fr:official&amp;client=firefox-a" target="_blank" rel="external">更多的库</a></li>
</ul>
<p>若你想更进一步使用本例，为让其中的代码变得通用和可复用，还要对代码做一些改进。这个练习你可以自己尝试下，这里有两个提示：首先，所有函数的第一个参数都相同，这就意味着这些函数需要有同一个执行上下文，使用一个对象来共享执行上下文是很明智的。此外，代码还得保证兼容，即代码最好能在兼容不同Web标准的多种浏览器下运行。</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/前端/">前端</a><a href="/tags/javascript/">javascript</a><a href="/tags/html/">html</a><a href="/tags/css/">css</a><a href="/tags/翻译/">翻译</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/前端/">前端</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://levonlin.info/2017/05/31/【译】怎样创建定制表单组件/" data-title="【译】怎样创建定制表单组件 | 荒村" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/06/21/【译】通过JavaScript发送表单/" title="【译】通过JavaScript发送表单">
  <strong>新一篇:</strong><br/>
  <span>
  【译】通过JavaScript发送表单</span>
</a>
</div>


<div class="next">
<a href="/2017/04/28/Promise-Summary/"  title="一起来学Promise">
 <strong>旧一篇:</strong><br/> 
 <span>一起来学Promise
</span>
</a>
</div>

</nav>

	
<section class="comment">
	
	<div class="ds-thread" data-title="【译】怎样创建定制表单组件" data-thread-key="【译】怎样创建定制表单组件" data-author-key="null" data-url="http://levonlin.info/post/【译】怎样创建定制表单组件"></div>
	
</section>


</div>  
    </div>
    <footer><div id="footer" >
	<div class="copyright">
		<span>Powered by <a href="https://github.com/hexojs/hexo">Hexo</a> and theme by 
		<a href="https://github.com/levonlin/Tinnypp">Tinnypp</a>.</span>
		
			<span>© Levon</span>
		
	<div>
</div></footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  //back to top
  function backToTop(){
    var buttonHTML = $("<a href=\"#top\" id=\"back-top\">" + "<span>Back to Top</span></a>");
    buttonHTML.appendTo($("body"));
    var buttonToTop = $("#back-top");
    // hide #back-top first
    buttonToTop.hide();

    // fade in #back-top
    $(function() {
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                buttonToTop.fadeIn();
            } else {
                buttonToTop.fadeOut();
            }
        });
        // scroll body to 0px on click
        buttonToTop.click(function() {
            $('body,html').animate({
                scrollTop: 0
            }, 800);
            return false;
        });
    });
  }
  backToTop();

  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      ta = $('#toc.toc-aside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
        
    }
  });

  var show = true;
  c.click(function(){
    if(show == true){
        a.addClass('fadeOut').css('display', 'none');
        ta.css('display', 'block').addClass('fadeIn');
        m.addClass('moveMain');  
    }else{
        a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');     
        ta.css('display', 'none'); 
        m.removeClass('moveMain');
        $('#toc.toc-aside').css('display', 'none');
    }
    show = !show;
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{

    $(window).scroll(function(){
      ta.css("top",Math.max(140,240-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"levonlingithubio"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '/js/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>

<script type="text/javascript">
  function footerPosition() {
    var contentHeight = document.documentElement.scrollHeight,
        winHeight = window.innerHeight;
    if(contentHeight <= winHeight) {
      $('footer').addClass('fixed-bottom');
    } else {
      $('footer').removeClass('fixed-bottom');
    }
  }
  footerPosition();
  $(window).resize(footerPosition);
</script>


  </body>
</html>
