
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>【译】通过JavaScript发送表单 | 荒村</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    
    <meta name="description" content="系列文章说明
原文


在发送表单数据一文中，HTML表单可以声明式地发送一个HTTP请求。但表单也可以用JavaScript来准备一个HTTP请求。本文将探索如何做到这点。
表单，不只是表单随着开放式Web应用的出现，现在提供HTML表单、而不是文字表单供用户填写的做法，已经越发普遍了。而越来越多">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="荒村" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/Tinny.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/Tinny.jpg">
    

  
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    
  

    <link rel="stylesheet" href="/css/style.css">
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?d182ed77fc48758bf45a33835ee35745";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

      <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

  _st('install','Rr85pzY1M1tZC1UWGo8f');
</script>
</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="荒村">荒村</a></h1>
				<h2 class="blog-motto">新草掩旧路，野鬼吟残书。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
                    <ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于我</a></li>
					
					<li>
					
						<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="st-search-inpu" maxlength="20" placeholder="Search" />
						</form>
					
					</li>
                <!--<li><div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div></li>-->

				</ul>
			</nav>	
</div>
    </header>
    <div id="container" class="clearfix">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/06/21/【译】通过JavaScript发送表单/" title="【译】通过JavaScript发送表单" itemprop="url">【译】通过JavaScript发送表单</a>
  </h1>
  <p class="article-time">
    <time datetime="2017-06-21T07:40:19.000Z" itemprop="datePublished">2017年 6月 21日</time>
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title"></strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#表单，不只是表单"><span class="toc-number">1.</span> <span class="toc-text">表单，不只是表单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#获得对数据传输的控制权"><span class="toc-number">1.1.</span> <span class="toc-text">获得对数据传输的控制权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#和传统表单处理的不同"><span class="toc-number">1.2.</span> <span class="toc-text">和传统表单处理的不同</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发送表单数据"><span class="toc-number">2.</span> <span class="toc-text">发送表单数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在隐藏的iframe中构建DOM"><span class="toc-number">2.1.</span> <span class="toc-text">在隐藏的iframe中构建DOM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#手动创建一个XMLHttpRequest"><span class="toc-number">2.2.</span> <span class="toc-text">手动创建一个XMLHttpRequest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用XMLHttpRequest和FormData对象"><span class="toc-number">2.3.</span> <span class="toc-text">使用XMLHttpRequest和FormData对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用独立的FormData对象"><span class="toc-number">2.3.1.</span> <span class="toc-text">使用独立的FormData对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#将FormData绑到表单元素上使用"><span class="toc-number">2.3.2.</span> <span class="toc-text">将FormData绑到表单元素上使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#处理二进制数据"><span class="toc-number">3.</span> <span class="toc-text">处理二进制数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结论"><span class="toc-number">4.</span> <span class="toc-text">结论</span></a></li></ol>
		</div>
		
		<blockquote>
<ul>
<li><a href="http://levonlin.info/2016/04/28/%E3%80%90%E8%AF%91%E3%80%91HTML%E8%A1%A8%E5%8D%95%E6%8C%87%E5%8D%97-%E7%AC%AC%E4%B8%80%E4%B8%AAHTML%E8%A1%A8%E5%8D%95/">系列文章说明</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Forms/Sending_forms_through_JavaScript" target="_blank" rel="external">原文</a></li>
</ul>
</blockquote>
<p>在<a href="http://levonlin.info/2016/09/24/%E3%80%90%E8%AF%91%E3%80%91%E5%8F%91%E9%80%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE/">发送表单数据</a>一文中，HTML表单可以声明式地发送一个<a href="https://developer.mozilla.org/en-US/docs/HTTP" target="_blank" rel="external">HTTP</a>请求。但表单也可以用JavaScript来准备一个HTTP请求。本文将探索如何做到这点。</p>
<h2 id="表单，不只是表单"><a href="#表单，不只是表单" class="headerlink" title="表单，不只是表单"></a>表单，不只是表单</h2><p>随着<a href="https://developer.mozilla.org/en-US/docs/Archive/B2G_OS/Quickstart/Intro_to_open_web_apps" target="_blank" rel="external">开放式Web应用</a>的出现，现在提供<a href="https://developer.mozilla.org/en-US/docs/HTML/Forms" target="_blank" rel="external">HTML表单</a>、而不是文字表单供用户填写的做法，已经越发普遍了。而越来越多的开发者也获得了数据传输的控制权。</p>
<h3 id="获得对数据传输的控制权"><a href="#获得对数据传输的控制权" class="headerlink" title="获得对数据传输的控制权"></a>获得对数据传输的控制权</h3><p>标准的HTML表单提交操作会加载数据发送到的URL，这就意味着浏览器的窗口中会进行整个页面的重新加载。而如果避免了页面的重新加载，就会避免页面的闪烁和网络延迟，进而提供更顺畅的用户体验。</p>
<p>在许多现代的UI设计中，HTML表单只是用来收集用户的输入。当用户要发送数据时，Web应用会进行控制，并在后台异步地发送数据，只更新UI中需要更改的部分。</p>
<p>能异步地发送任意数据的技术称为<a href="https://developer.mozilla.org/en-US/docs/AJAX" target="_blank" rel="external">AJAX</a>，表示“异步的JavaScript和XML”。</p>
<h3 id="和传统表单处理的不同"><a href="#和传统表单处理的不同" class="headerlink" title="和传统表单处理的不同"></a>和传统表单处理的不同</h3><p>AJAX使用了<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" target="_blank" rel="external">XMLHttpRequest</a>(XHR)DOM对象，它可以建立HTTP请求、发送请求并处理结果。</p>
<blockquote>
<p><strong>注意：</strong> 老的AJAX技术可能不是用XMLHttpRequest。比如<a href="http://en.wikipedia.org/wiki/JSONP" target="_blank" rel="external">JSONP</a>和<a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Forms/Sending_forms_through_JavaScript" target="_blank" rel="external">eval()</a>函数结合起来使用。虽然该方法可行，但不推荐使用它，因为其存在严重的安全问题。所以除非为了兼容那些特别老旧、不支持XMLHttpRequest或<a href="https://developer.mozilla.org/en-US/docs/JSON" target="_blank" rel="external">JSON</a>的浏览器，还是<strong>避免使用该技术</strong>。</p>
</blockquote>
<p>由于历史原因，XMLHttpRequest本是设计用来获取和发送交换格式为<a href="https://developer.mozilla.org/en-US/docs/XML" target="_blank" rel="external">XML</a>的数据的。但现在JSON取代了XML，有着更普遍的使用。</p>
<p>不过XML和JSON都不符合作为表单数据请求的编码。表单数据（<code>application/x-www-form-urlencoded</code>）是用于构造键值对的URL编码列表的，若是要传输二进制数据，HTTP请求会被重塑为<code>multipart/form-data</code>。</p>
<p>若你能掌控前端（运行在浏览器上的代码）和后端（运行在服务器上的代码），你就能发送JSON或XML、并随心所欲地处理它们。</p>
<p>但如果你使用的是第三方服务，这就没那么容易了，因为某些服务只接受表单数据。当然也有使用表单数据处理起来更方便的情况，比如数据是键值对或二进制数据时，用现成的后端工具就能处理它们、不需要额外的代码。</p>
<p>那么，具体该如何发送数据呢？</p>
<h2 id="发送表单数据"><a href="#发送表单数据" class="headerlink" title="发送表单数据"></a>发送表单数据</h2><p>目前有三种方式来发送表单数据，既有老旧的技术、也有新特性<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/FormData" target="_blank" rel="external">FormData</a>对象，接下来就来深入了解下它们。</p>
<h3 id="在隐藏的iframe中构建DOM"><a href="#在隐藏的iframe中构建DOM" class="headerlink" title="在隐藏的iframe中构建DOM"></a>在隐藏的iframe中构建DOM</h3><p>发送表单数据最古老的方法，是用DOM API建立一个表单，然后发送数据到一个隐藏的<code>&lt;iframe&gt;</code>。为了访问你提交内容的处理结果，应检索下<code>&lt;iframe&gt;</code>的内容。</p>
<blockquote>
<p><strong>警告：避免使用该技术。</strong>在使用第三方服务时，该技术有安全风险，因为它会导致你面临<a href="http://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank" rel="external">脚本注入攻击</a>。若你使用HTTPS，使用<code>&lt;ifrme&gt;</code>发送表单还会影响<a href="https://developer.mozilla.org/en-US/docs/JavaScript/Same_origin_policy_for_JavaScript" target="_blank" rel="external">同源策略</a>，并导致内容被发送到一个无法访问的<code>&lt;ifrme&gt;</code>中。当然如果你要兼容很老旧的浏览器，这项技术可能就是你唯一的选择了。</p>
</blockquote>
<p>下面是一个例子：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"sendData(</span></span></span><span class="template-variable">&#123;test:'ok'&#125;</span><span class="xml"><span class="tag"><span class="string">)"</span>&gt;</span>Click Me!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建一个iFrame来发送我们的数据</span></div><div class="line"><span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</div><div class="line">iframe.name = <span class="string">"myTarget"</span>;</div><div class="line"></div><div class="line"><span class="comment">// 将iFrame添加到文档流中</span></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  iframe.style.display = <span class="string">"none"</span>;</div><div class="line">  <span class="built_in">document</span>.body.appendChild(iframe);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 用来发送数据的函数</span></div><div class="line"><span class="comment">// 需要一个参数，是一个由键值对组成的对象</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendData</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> name,</div><div class="line">      form = <span class="built_in">document</span>.createElement(<span class="string">"form"</span>),</div><div class="line">      node = <span class="built_in">document</span>.createElement(<span class="string">"input"</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 定义响应加载时的行为</span></div><div class="line">  iframe.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    alert(<span class="string">"Yeah! Data sent."</span>);</div><div class="line">  &#125;);</div><div class="line">    </div><div class="line">  form.action = <span class="string">"http://www.cs.tut.fi/cgi-bin/run/~jkorpela/echo.cgi"</span>;</div><div class="line">  form.target = iframe.name;</div><div class="line"></div><div class="line">  <span class="keyword">for</span>(name <span class="keyword">in</span> data) &#123;</div><div class="line">    node.name  = name;</div><div class="line">    node.value = data[name].toString();</div><div class="line">    form.appendChild(node.cloneNode());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 要发送数据，表单得添加到文档流中</span></div><div class="line">  form.style.display = <span class="string">"none"</span>;</div><div class="line">  <span class="built_in">document</span>.body.appendChild(form);</div><div class="line"></div><div class="line">  form.submit();</div><div class="line"></div><div class="line">  <span class="comment">// 表单一发送就移除它</span></div><div class="line">  <span class="built_in">document</span>.body.removeChild(form);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果如下：<br><a href="https://mdn.mozillademos.org/en-US/docs/Learn/HTML/Forms/Sending_forms_through_JavaScript$samples/Building_a_DOM_in_a_hidden_iframe?revision=1226811" target="_blank" rel="external">效果</a></p>
<h3 id="手动创建一个XMLHttpRequest"><a href="#手动创建一个XMLHttpRequest" class="headerlink" title="手动创建一个XMLHttpRequest"></a>手动创建一个XMLHttpRequest</h3><p>XMLHttpRequest是发送HTTP请求最安全和可靠的方式。要想用XMLHttpRequest发送表单数据，得先用URL编码要发送的数据，并遵循表单数据请求的规范。</p>
<blockquote>
<p><strong>注意：</strong> 若想了解更多关于XMLHttpRequest，这几篇文章可能对你有用：<a href="https://developer.mozilla.org/en-US/docs/AJAX/Getting_Started" target="_blank" rel="external">An introductory article to AJAX</a>，以及一个关于<a href="https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest/Using_XMLHttpRequest" target="_blank" rel="external">使用XMLHttpRequest</a>的高级教程。</p>
</blockquote>
<p>来重构下我们先前的例子：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"sendData(</span></span></span><span class="template-variable">&#123;test:'ok'&#125;</span><span class="xml"><span class="tag"><span class="string">)"</span>&gt;</span>Click Me!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>如你所见，HTML部分并未真的有所改变，但JavaScript部分就完全不同了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendData</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> XHR = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  <span class="keyword">var</span> urlEncodedData = <span class="string">""</span>;</div><div class="line">  <span class="keyword">var</span> urlEncodedDataPairs = [];</div><div class="line">  <span class="keyword">var</span> name;</div><div class="line"></div><div class="line">  <span class="comment">// 将data对象转为一个URL编码的键值对数组</span></div><div class="line">  <span class="keyword">for</span>(name <span class="keyword">in</span> data) &#123;</div><div class="line">    urlEncodedDataPairs.push(<span class="built_in">encodeURIComponent</span>(name) + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(data[name]));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 将键值对组合成一个字符串，并把所有经过URL编码的空格替换为'+'号；以符合浏览器表单提交的行为</span></div><div class="line">  <span class="comment">// the '+' character; matches the behaviour of browser form submissions.</span></div><div class="line">  urlEncodedData = urlEncodedDataPairs.join(<span class="string">'&amp;'</span>).replace(<span class="regexp">/%20/g</span>, <span class="string">'+'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 定义成功的数据提交后会发生什么</span></div><div class="line">  XHR.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    alert(<span class="string">'Yeah! Data sent and response loaded.'</span>);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// 定义失败的情况会发生什么</span></div><div class="line">  XHR.addEventListener(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    alert(<span class="string">'Oups! Something goes wrong.'</span>);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// 配置请求</span></div><div class="line">  XHR.open(<span class="string">'POST'</span>, <span class="string">'https://example.com/cors.php'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 添加表单数据POST请求所需的HTTP请求头</span></div><div class="line">  XHR.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 最后，发送数据</span></div><div class="line">  XHR.send(urlEncodedData);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果如下：<br><a href="https://mdn.mozillademos.org/en-US/docs/Learn/HTML/Forms/Sending_forms_through_JavaScript$samples/Building_an_XMLHttpRequest_manually?revision=1226811" target="_blank" rel="external">效果</a></p>
<blockquote>
<p><strong>注意：</strong> 若你想使用此处的XMLHttpRequest方法发送数据到第三方网站，也会受到同源策略的限制。要实现跨域请求，还需要<a href="https://developer.mozilla.org/en-US/docs/HTTP/Access_control_CORS" target="_blank" rel="external">CORS和HTTP访问控制</a>。</p>
</blockquote>
<h3 id="使用XMLHttpRequest和FormData对象"><a href="#使用XMLHttpRequest和FormData对象" class="headerlink" title="使用XMLHttpRequest和FormData对象"></a>使用XMLHttpRequest和FormData对象</h3><p>手动构建HTTP请求是挺麻烦的，幸运的是，最近的一项<a href="http://www.w3.org/TR/XMLHttpRequest/" target="_blank" rel="external">XMLHttpRequest标准</a>提供了一个处理表单请求的简便方法–FormData对象。</p>
<p>FormData对象可被用来建立要传输的表单数据，或者从表单元素中获取数据来管理如何发送。要注意FormData对象是“只写”的，这意味着你可以改变它们、但不能访问它们的内容。</p>
<p>使用FormData对象的方法会在<a href="http://levonlin.info/2017/07/15/%E3%80%90%E8%AF%91%E3%80%91%E4%BD%BF%E7%94%A8FormData%E5%AF%B9%E8%B1%A1/">使用FormData对象</a>一文中详细介绍，下面有两个例子：</p>
<h4 id="使用独立的FormData对象"><a href="#使用独立的FormData对象" class="headerlink" title="使用独立的FormData对象"></a>使用独立的FormData对象</h4><figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"sendData(</span></span></span><span class="template-variable">&#123;test:'ok'&#125;</span><span class="xml"><span class="tag"><span class="string">)"</span>&gt;</span>Click Me!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>现在你该很熟悉这个HTML的样子了。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendData</span><span class="params">(data)</span> </span>&#123;</div><div class="line">  <span class="keyword">var</span> XHR = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  <span class="keyword">var</span> FD  = <span class="keyword">new</span> FormData();</div><div class="line"></div><div class="line">  <span class="comment">// 将数据添加到FormData对象中</span></div><div class="line">  <span class="keyword">for</span>(name <span class="keyword">in</span> data) &#123;</div><div class="line">    FD.append(name, data[name]);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 定义成功的数据提交后会发生什么</span></div><div class="line">  XHR.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</div><div class="line">    alert(<span class="string">'Yeah! Data sent and response loaded.'</span>);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// 定义失败的情况会发生什么</span></div><div class="line">  XHR.addEventListener(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</div><div class="line">    alert(<span class="string">'Oups! Something went wrong.'</span>);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// 配置请求</span></div><div class="line">  XHR.open(<span class="string">'POST'</span>, <span class="string">'https://example.com/cors.php'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 发送FormData对象，HTTP头会自动设置</span></div><div class="line">  XHR.send(FD);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果如下：<br><a href="https://mdn.mozillademos.org/en-US/docs/Learn/HTML/Forms/Sending_forms_through_JavaScript$samples/Using_a_standalone_FormData_object?revision=1226811" target="_blank" rel="external">效果</a></p>
<h4 id="将FormData绑到表单元素上使用"><a href="#将FormData绑到表单元素上使用" class="headerlink" title="将FormData绑到表单元素上使用"></a>将FormData绑到表单元素上使用</h4><p>你也可以将FormData对象绑定到一个表单元素上，这样做会创建一个FormData对象来表示表单中的数据。</p>
<p>HTML是典型的表单：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="selector-tag">form</span> id=<span class="string">"myForm"</span>&gt;</div><div class="line">  &lt;<span class="selector-tag">label</span> <span class="keyword">for</span>=<span class="string">"myName"</span>&gt;Send me your name:&lt;/label&gt;</div><div class="line">  &lt;<span class="selector-tag">input</span> id=<span class="string">"myName"</span> name=<span class="string">"name"</span> value=<span class="string">"John"</span>&gt;</div><div class="line">  &lt;<span class="selector-tag">input</span> type=<span class="string">"submit"</span> value=<span class="string">"Send Me!"</span>&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure>
<p>但JavaScript会接管表单的提交操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sendData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> XHR = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line"></div><div class="line">    <span class="comment">// 绑定FormData对象和表单元素</span></div><div class="line">    <span class="keyword">var</span> FD = <span class="keyword">new</span> FormData(form);</div><div class="line"></div><div class="line">    <span class="comment">// 定义成功的数据提交后会发生什么</span></div><div class="line">    XHR.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">      alert(event.target.responseText);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// 定义失败的情况会发生什么</span></div><div class="line">    XHR.addEventListener(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">      alert(<span class="string">'Oups! Something goes wrong.'</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// 配置请求</span></div><div class="line">    XHR.open(<span class="string">"POST"</span>, <span class="string">"https://example.com/cors.php"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 发送的数据是用户在表单中提供的</span></div><div class="line">    XHR.send(FD);</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  <span class="comment">// 访问表单元素</span></div><div class="line">  <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 并接管其submit事件</span></div><div class="line">  form.addEventListener(<span class="string">"submit"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">    event.preventDefault();</div><div class="line"></div><div class="line">    sendData();</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>结果如下：<br><a href="https://mdn.mozillademos.org/en-US/docs/Learn/HTML/Forms/Sending_forms_through_JavaScript$samples/Using_FormData_bound_to_a_form_element?revision=1226811" target="_blank" rel="external">效果</a></p>
<h2 id="处理二进制数据"><a href="#处理二进制数据" class="headerlink" title="处理二进制数据"></a>处理二进制数据</h2><p>若你在一个含有<code>&lt;input type=&quot;file&quot;&gt;</code>组件的表单中使用FormData对象，那么数据会被自动处理。但要手动发送二进制数据的话，还有很多额外工作要做。</p>
<p>现代Web有很多二进制数据源：比如<a href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader" target="_blank" rel="external">FileReader</a>、<a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement" target="_blank" rel="external">Canvas</a>、<a href="https://developer.mozilla.org/en-US/docs/WebRTC/navigator.getUserMedia" target="_blank" rel="external">WebRTC</a>。但不幸的是，某些老旧浏览器不能访问二进制数据或者需要复杂的方法才能实现。这些遗留的问题已不在本文讨论范围之内。若你想了解更多关于FileReader API，请阅读<a href="https://developer.mozilla.org/en-US/docs/Using_files_from_web_applications" target="_blank" rel="external">Using files from web applications</a>。</p>
<p>用FormData来发送二进制是很直接的，使用<code>append()</code>方法就好了。但要手动做到这点，就需要一些技巧了。</p>
<p>在下面的例子中，我们会用来FileReader API来访问二进制数据，然后手动建立多部分的表单数据请求。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"myForm"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"i1"</span>&gt;</span>text data:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"i1"</span> <span class="attr">name</span>=<span class="string">"myText"</span> <span class="attr">value</span>=<span class="string">"Some text data"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"i2"</span>&gt;</span>file data:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"i2"</span> <span class="attr">name</span>=<span class="string">"myFile"</span> <span class="attr">type</span>=<span class="string">"file"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">button</span>&gt;</span>Send Me!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>如你所见，HTML用了标准的<code>&lt;form&gt;</code>，这没什么神奇的。“神奇”的部分在JavaScript里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 由于我们要访问DOM结点，所以得在页面加载完后才初始化脚本</span></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// 这些变量用来存储表单数据</span></div><div class="line">  <span class="keyword">var</span> text = <span class="built_in">document</span>.getElementById(<span class="string">"i1"</span>);</div><div class="line">  <span class="keyword">var</span> file = &#123;</div><div class="line">        <span class="attr">dom</span>    : <span class="built_in">document</span>.getElementById(<span class="string">"i2"</span>),</div><div class="line">        <span class="attr">binary</span> : <span class="literal">null</span></div><div class="line">      &#125;;</div><div class="line"> </div><div class="line">  <span class="comment">// 使用FileReader API来访问文件内容</span></div><div class="line">  <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line"></div><div class="line">  <span class="comment">// 由于FileReader是异步的，所以得在其完成文件读取后才存储结果</span></div><div class="line">  reader.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    file.binary = reader.result;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// 在页面加载时，若已经选择了文件就直接读取它</span></div><div class="line">  <span class="keyword">if</span>(file.dom.files[<span class="number">0</span>]) &#123;</div><div class="line">    reader.readAsBinaryString(file.dom.files[<span class="number">0</span>]);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 否则在用户选择文件时再读取它</span></div><div class="line">  file.dom.addEventListener(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(reader.readyState === FileReader.LOADING) &#123;</div><div class="line">      reader.abort();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    reader.readAsBinaryString(file.dom.files[<span class="number">0</span>]);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// sendData是本例的主要函数</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sendData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 若已经选择了文件，就等浏览器读取完</span></div><div class="line">    <span class="comment">// 否则就延迟本函数的执行</span></div><div class="line">    <span class="keyword">if</span>(!file.binary &amp;&amp; file.dom.files.length &gt; <span class="number">0</span>) &#123;</div><div class="line">      setTimeout(sendData, <span class="number">10</span>);</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 要构建多部分的表单数据请求，需要一个XMLHttpRequest实例</span></div><div class="line">    <span class="keyword">var</span> XHR = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line"></div><div class="line">    <span class="comment">// 需要一个分隔符来定义请求体的每部分</span></div><div class="line">    <span class="keyword">var</span> boundary = <span class="string">"blob"</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 将请求体存为一个字符串</span></div><div class="line">    <span class="keyword">var</span> data = <span class="string">""</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 若用户选择了文件</span></div><div class="line">    <span class="keyword">if</span> (file.dom.files[<span class="number">0</span>]) &#123;</div><div class="line">      <span class="comment">// 开启请求体的新部分</span></div><div class="line">      data += <span class="string">"--"</span> + boundary + <span class="string">"\r\n"</span>;</div><div class="line"></div><div class="line">      <span class="comment">// 该部分描述为表单数据</span></div><div class="line">      data += <span class="string">'content-disposition: form-data; '</span></div><div class="line">      <span class="comment">// 定义表单数据的名字</span></div><div class="line">            + <span class="string">'name="'</span>         + file.dom.name          + <span class="string">'"; '</span></div><div class="line">      <span class="comment">// 提供真实的文件名</span></div><div class="line">            + <span class="string">'filename="'</span>     + file.dom.files[<span class="number">0</span>].name + <span class="string">'"\r\n'</span>;</div><div class="line">      <span class="comment">// 提供文件的MIME类型</span></div><div class="line">      data += <span class="string">'Content-Type: '</span> + file.dom.files[<span class="number">0</span>].type + <span class="string">'\r\n'</span>;</div><div class="line"></div><div class="line">      <span class="comment">// 元数据和真实数据部分间有一个空行</span></div><div class="line">      data += <span class="string">'\r\n'</span>;</div><div class="line">      </div><div class="line">      <span class="comment">// 往请求体里添加二进制数据</span></div><div class="line">      data += file.binary + <span class="string">'\r\n'</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 文本数据的组织更加简单</span></div><div class="line">    <span class="comment">// 开启请求体的新部分</span></div><div class="line">    data += <span class="string">"--"</span> + boundary + <span class="string">"\r\n"</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 描述为表单数据并命名</span></div><div class="line">    data += <span class="string">'content-disposition: form-data; name="'</span> + text.name + <span class="string">'"\r\n'</span>;</div><div class="line">    <span class="comment">// 元数据和真实数据部分间有一个空行</span></div><div class="line">    data += <span class="string">'\r\n'</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 往请求体里添加文本数据</span></div><div class="line">    data += text.value + <span class="string">"\r\n"</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 完成了所有部分，就“闭合”请求体</span></div><div class="line">    data += <span class="string">"--"</span> + boundary + <span class="string">"--"</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 定义成功的数据提交后会发生什么</span></div><div class="line">    XHR.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">      alert(<span class="string">'Yeah! Data sent and response loaded.'</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// 定义失败的情况会发生什么</span></div><div class="line">    XHR.addEventListener(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">      alert(<span class="string">'Oups! Something went wrong.'</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// 配置请求</span></div><div class="line">    XHR.open(<span class="string">'POST'</span>, <span class="string">'https://example.com/cors.php'</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 添加必要的HTTP请求头来处理多部分表单数据的POST请求</span></div><div class="line">    XHR.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'multipart/form-data; boundary='</span> + boundary);</div><div class="line"></div><div class="line">    <span class="comment">// 最后，发送数据</span></div><div class="line">    XHR.send(data);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 访问表单</span></div><div class="line">  <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 接管submit事件</span></div><div class="line">  form.addEventListener(<span class="string">'submit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">    event.preventDefault();</div><div class="line">    sendData();</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>结果如下：<br><a href="https://mdn.mozillademos.org/en-US/docs/Learn/HTML/Forms/Sending_forms_through_JavaScript$samples/Dealing_with_binary_data?revision=1226811" target="_blank" rel="external">效果</a></p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>浏览器的不同，导致通过JavaScript发送表单数据可以简单或很困难。FromData对象是通常的解决方案，而且我们应该毫不犹豫地在老旧浏览器上使用其polyfill：</p>
<ul>
<li><a href="https://gist.github.com/3120320" target="_blank" rel="external">这个gist</a>用Web Workers来提供FromData</li>
<li><a href="https://github.com/francois2metz/html5-formdata" target="_blank" rel="external">HTML5-formdata</a>致力于提供FromData对象的polyfill，但这得依赖<a href="http://www.w3.org/TR/FileAPI/" target="_blank" rel="external">File API</a></li>
<li><a href="https://github.com/jimmywarting/FormData" target="_blank" rel="external">这个polyfill</a>提供了FromData的大部分新方法（entries, keys, values和对for…of的支持）</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/前端/">前端</a><a href="/tags/javascript/">javascript</a><a href="/tags/html/">html</a><a href="/tags/翻译/">翻译</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/前端/">前端</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://levonlin.info/2017/06/21/【译】通过JavaScript发送表单/" data-title="【译】通过JavaScript发送表单 | 荒村" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/07/15/【译】使用FormData对象/" title="【译】使用FormData对象">
  <strong>新一篇:</strong><br/>
  <span>
  【译】使用FormData对象</span>
</a>
</div>


<div class="next">
<a href="/2017/05/31/【译】怎样创建定制表单组件/"  title="【译】怎样创建定制表单组件">
 <strong>旧一篇:</strong><br/> 
 <span>【译】怎样创建定制表单组件
</span>
</a>
</div>

</nav>

	
<section class="comment">
	
	<div class="ds-thread" data-title="【译】通过JavaScript发送表单" data-thread-key="【译】通过JavaScript发送表单" data-author-key="null" data-url="http://levonlin.info/post/【译】通过JavaScript发送表单"></div>
	
</section>


</div>  
    </div>
    <footer><div id="footer" >
	<div class="copyright">
		<span>Powered by <a href="https://github.com/hexojs/hexo">Hexo</a> and theme by 
		<a href="https://github.com/levonlin/Tinnypp">Tinnypp</a>.</span>
		
			<span>© Levon</span>
		
	<div>
</div></footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  //back to top
  function backToTop(){
    var buttonHTML = $("<a href=\"#top\" id=\"back-top\">" + "<span>Back to Top</span></a>");
    buttonHTML.appendTo($("body"));
    var buttonToTop = $("#back-top");
    // hide #back-top first
    buttonToTop.hide();

    // fade in #back-top
    $(function() {
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                buttonToTop.fadeIn();
            } else {
                buttonToTop.fadeOut();
            }
        });
        // scroll body to 0px on click
        buttonToTop.click(function() {
            $('body,html').animate({
                scrollTop: 0
            }, 800);
            return false;
        });
    });
  }
  backToTop();

  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      ta = $('#toc.toc-aside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
        
    }
  });

  var show = true;
  c.click(function(){
    if(show == true){
        a.addClass('fadeOut').css('display', 'none');
        ta.css('display', 'block').addClass('fadeIn');
        m.addClass('moveMain');  
    }else{
        a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');     
        ta.css('display', 'none'); 
        m.removeClass('moveMain');
        $('#toc.toc-aside').css('display', 'none');
    }
    show = !show;
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{

    $(window).scroll(function(){
      ta.css("top",Math.max(140,240-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"levonlingithubio"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '/js/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>

<script type="text/javascript">
  function footerPosition() {
    var contentHeight = document.documentElement.scrollHeight,
        winHeight = window.innerHeight;
    if(contentHeight <= winHeight) {
      $('footer').addClass('fixed-bottom');
    } else {
      $('footer').removeClass('fixed-bottom');
    }
  }
  footerPosition();
  $(window).resize(footerPosition);
</script>


  </body>
</html>
